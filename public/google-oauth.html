<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google OAuth Test</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="max-w-4xl mx-auto p-5">
        <div class="bg-white p-8 rounded-lg shadow-lg">
            <h1 class="text-3xl font-bold text-gray-800 text-center mb-8">Google OAuth Test</h1>

            <div class="flex justify-center mb-8">
                <div id="g_id_onload"
                     data-client_id="601242822411-7gaj5b2vpp5clpbld3e9hsg88m7cb6cj.apps.googleusercontent.com"
                     data-callback="handleCredentialResponse"
                     data-auto_prompt="false">
                </div>
                <div class="g_id_signin"
                     data-type="standard"
                     data-size="large"
                     data-theme="outline"
                     data-text="sign_in_with"
                     data-shape="rectangular"
                     data-logo_alignment="left">
                </div>
            </div>

            <div id="response" class="hidden mt-5 p-4 rounded-lg bg-blue-50 border border-blue-200 text-blue-800 font-mono text-sm whitespace-pre-wrap">
                Ready to test Google OAuth...
            </div>

            <div class="mt-8">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Manual Test (for development):</h3>
                <div class="flex flex-col sm:flex-row gap-4">
                    <button onclick="testAPI()"
                            class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 font-medium">
                        Test API Health
                    </button>
                </div>
            </div>

            <!-- Debug Info -->
            <div class="mt-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
                <h4 class="text-sm font-semibold text-gray-600 mb-2">Debug Info:</h4>
                <p class="text-xs text-gray-500 font-mono">
                    Current Origin: <span id="current-origin" class="text-blue-600"></span>
                </p>
                <p class="text-xs text-gray-500 mt-1">
                    Make sure this origin is added to Google Cloud Console > OAuth Client > Authorized JavaScript origins
                </p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api';

        function handleCredentialResponse(response) {
            console.log("Encoded JWT ID token: " + response.credential);

            showResponse("Sending token to server...", "loading");

            fetch(`${API_BASE_URL}/auth/google`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    credential: response.credential
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                showResponse(JSON.stringify(data, null, 2), "success");
            })
            .catch(error => {
                console.error('Error:', error);
                showResponse(`Error: ${error.message}`, "error");
            });
        }

        function showResponse(message, type) {
            const responseDiv = document.getElementById('response');
            responseDiv.textContent = message;

            responseDiv.className = 'mt-5 p-4 rounded-lg font-mono text-sm whitespace-pre-wrap';

            switch(type) {
                case 'success':
                    responseDiv.className += ' bg-green-50 border border-green-200 text-green-800';
                    break;
                case 'error':
                    responseDiv.className += ' bg-red-50 border border-red-200 text-red-800';
                    break;
                case 'loading':
                    responseDiv.className += ' bg-yellow-50 border border-yellow-200 text-yellow-800';
                    break;
                default:
                    responseDiv.className += ' bg-blue-50 border border-blue-200 text-blue-800';
            }

            responseDiv.classList.remove('hidden');
        }

        function testAPI() {
            fetch(`${API_BASE_URL}/health`)
            .then(response => response.json())
            .then(data => {
                console.log('API Health:', data);
                showResponse(`API is running: ${JSON.stringify(data, null, 2)}`, "info");
            })
            .catch(error => {
                console.error('API Health check failed:', error);
                showResponse(`API Health check failed: ${error.message}`, "error");
            });
        }

        window.onload = function() {
            const originSpan = document.getElementById('current-origin');
            if (originSpan) {
                originSpan.textContent = window.location.origin;
            }

            console.log('PAGE ORIGIN =', window.location.origin);
            testAPI();
        };
    </script>
</body>
</html>
